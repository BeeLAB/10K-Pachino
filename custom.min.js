function initTask(){""!=document.getElementById("task-name").value&&(document.getElementById("task-name").readOnly=!0,document.getElementById("task").className="ready",document.getElementById("timer").className="show",tasksList.push({name:document.getElementById("task-name").value,pomo:0,interrupt:{num:0,time:0},total:0}),startTimer())}function startTimer(){timerCompleted=!1,timerValue=timerCount,document.getElementById("counter").className="counting",document.getElementById("btn-clear").className="hide",document.getElementById("tgl-timer").innerHTML="&#x025AA;",appTimer=setInterval(function(){countDown(timerValue)},1e3)}function stopTimer(){soundLoaded&&sound.play(),timerCompleted?(document.getElementById("pomodoros").innerHTML+='<span class="pomo"></span>',tasksList[currentTaskIndex].pomo++,canNotify?sendNotification("DING! ***","One pachino is gone!"):alert("DING! *** One pachino is gone!")):(document.getElementById("pomodoros").innerHTML+='<span class="pomo interrupt"></span>',tasksList[currentTaskIndex].interrupt.num++,tasksList[currentTaskIndex].interrupt.time+=timerCount-timerValue),tasksList[currentTaskIndex].total=tasksList[currentTaskIndex].pomo*timerCount+tasksList[currentTaskIndex].interrupt.time,timerValue=0,document.title="pachino",document.getElementById("counter").className="",document.getElementById("counter").innerHTML="25:00",document.getElementById("pomodoros").className="show",document.getElementById("tgl-timer").innerHTML="&#x025B8;",clearInterval(appTimer)}function tglTimer(){timerValue>0?stopTimer():startTimer()}function countDown(a){if(timerValue=a,timerValue--,timerValue>0){var b=Math.floor(timerValue/60),c=timerValue-60*b;document.title="pachino [ "+b+":"+c+" ]",document.getElementById("counter").innerHTML=b+":"+c}else timerCompleted=!0,stopTimer()}function taskDone(){timerValue>0&&stopTimer(),document.getElementById("task-name").readOnly=!1,document.getElementById("task-name").value="",document.getElementById("task").className="",document.getElementById("timer").className="",document.getElementById("pomodoros").className="",document.getElementById("pomodoros").innerHTML="",document.getElementById("btn-clear").className="btn",currentTaskIndex++,updateTasksList()}function updateTasksList(){for(document.getElementById("tasks-list").innerHTML="",i=0;i<tasksList.length;i++){var a=Math.floor(tasksList[i].total/60),b=tasksList[i].total-60*a;document.getElementById("tasks-list").innerHTML+='<li><span class="num"><span class="pomo"></span> '+tasksList[i].pomo+'</span><span class="num"><span class="pomo interrupt"></span> '+tasksList[i].interrupt.num+'</span><span class="time">'+a+":"+b+'</span><span class="name">'+tasksList[i].name+"</span></li>"}document.getElementById("tasks").className="show",window.localStorage.setItem("pachino",JSON.stringify(tasksList)),console.log("Tasks list:",tasksList)}function clearTasks(){document.getElementById("tasks").className="",document.getElementById("tasks-list").innerHTML="",tasksList=[],currentTaskIndex=0,window.localStorage.removeItem("pachino")}function sendNotification(a,b){new Notification(a,{body:b})}var local_list,tasksList=[],currentTaskIndex=0,sound=new Audio("http://soundbible.com/mp3/Electronic_Chime-KevanGC-495939803.mp3"),soundLoaded=!1,canNotify=!1,timerCompleted=!1,timerCount=1500,timerValue=0,appTimer;Notification.requestPermission().then(function(a){"granted"===a&&(canNotify=!0)}),sound.addEventListener("canplaythrough",function(){soundLoaded=!0},!1),local_list=window.localStorage.getItem("pachino"),local_list&&(tasksList=JSON.parse(local_list),currentTaskIndex=tasksList.length,updateTasksList()),document.getElementById("btn-init").addEventListener("click",function(){initTask()}),document.getElementById("task-name").addEventListener("keypress",function(a){var b=a.which||a.keyCode;document.getElementById("task-name").readOnly||13!==b||initTask()}),document.getElementById("btn-done").addEventListener("click",function(){taskDone()}),document.getElementById("tgl-timer").addEventListener("click",function(){tglTimer()}),document.getElementById("btn-clear").addEventListener("click",function(){clearTasks()});